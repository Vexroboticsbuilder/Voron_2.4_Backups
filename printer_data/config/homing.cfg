[homing_override]
axes: yxz
set_position_z: 0
gcode:
    # 1. Lift Z to clear the bed if its position is known
    G91 ; Use relative positioning
    G0 Z10 F600 ; Move Z up 10mm
    G90 ; Use absolute positioning
    
    # 2. Set a higher homing current for sensorless homing
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT=0.9
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT=0.9
    
    # 3. Perform sensorless homing for X and Y
    G28 Y
    G91
    G90
    G0 Y1 F6000
    G28 X
    
    # 4. Move to the safe Z home position (X:150, Y:150)
    G0 X150 Y150 F6000 ; Move to center of the bed for Z homing
    
    # 5. Home the Z-axis with the probe
    G28 Z
    
    # 6. Set the current back to the normal run current
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.settings['tmc2209 stepper_x'].run_current}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.settings['tmc2209 stepper_y'].run_current}
    
    # 7. Move nozzle to safe position after homing
    G0 X150 Y150 Z30 F3600
    